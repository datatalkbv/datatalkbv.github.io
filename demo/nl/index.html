<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTalk voor Legal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .sidebar {
            height: calc(100vh - 56px);
            position: fixed;
            top: 56px;
            left: 0;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        .card-body ul li {
            margin-bottom: 10px;
        }
        .card-body ul li i {
            width: 20px;
            text-align: center;
            margin-right: 10px;
            color: #007bff;
        }

        .result-item {
            cursor: pointer;
        }
        .selected {
            background-color: #e9ecef;
        }
        .diff-highlight {
            text-decoration: underline;
            text-decoration-color: #007bff;
            text-decoration-thickness: 2px;
        }
        #descriptionPanel {
            position: fixed;
            top: 76px;
            right: 20px;
            width: 300px;
            background-color: #ffffff;
            border: none;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .btn {
            border-radius: 25px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .form-control {
            border-radius: 25px;
            padding: 10px 20px;
        }
        .alert {
            border-radius: 15px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        .nav-link {
            color: #495057;
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            color: #007bff;
        }
        .user-profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .progress {
            height: 8px;
            margin-top: 10px;
        }
        #descriptionPanel {
            display: none;
        }
        #startDemoButton {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            padding: 15px 30px;
            font-size: 18px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #startDemoButton:hover {
            background-color: #0056b3;
        }
        .nav-link i {
            width: 20px;
            text-align: center;
            margin-right: 10px;
        }
        .card-text i {
            width: 20px;
            text-align: center;
            margin-right: 10px;
        }
        #narrationOverlay {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            z-index: 10001;
            display: none;
            max-width: 80%;
        }
        #closeNarration {
            position: absolute;
            top: 5px;
            right: 10px;
            color: white;
            cursor: pointer;
            font-size: 20px;
        }
        #demoControls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 10002;
            display: flex;
            gap: 10px;
        }
        #demoControls button {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .user-profile {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }
        .user-icon {
            font-size: 2.5rem;
            color: #007bff;
            margin-right: 0.5rem;
        }
        .user-info {
            display: flex;
            flex-direction: column;
        }
        #startDemoButton {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background-color: #28a745;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    
        #startDemoButton:hover {
            background-color: #218838;
            transform: translate(-50%, -50%) scale(1.05);
        }
    
        #startDemoButton:active {
            transform: translate(-50%, -50%) scale(0.95);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">DataTalk voor Legal</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-bell"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-cog"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-user"></i> Jan Jansen</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="user-profile">
                    <div class="user-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <h6 class="mb-0">Jan Jansen</h6>
                        <small class="text-muted">Juridisch Analist</small>
                    </div>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-search"></i> Clausule Zoeken</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-file-contract"></i> Mijn Contracten</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-history"></i> Geschiedenis</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-chart-bar"></i> Analyses</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-users"></i> Team</a>
                    </li>
                </ul>
                <hr>
                <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Opgeslagen Zoekopdrachten</span>
                    <a class="link-secondary" href="#" aria-label="Voeg een nieuwe opgeslagen zoekopdracht toe">
                        <i class="fas fa-plus-circle"></i>
                    </a>
                </h6>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                        <a class="nav-link" href="#">NDA</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Betaling</a>
                    </li>
                </ul>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Clausule Zoeken</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary">Delen</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary">Exporteren</button>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">Contract Analyses</h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-file-contract"></i> Totaal Contracten: 1.250</li>
                                    <li><i class="fas fa-search"></i> Clausules Gevonden Deze Maand: 750</li>
                                    <li><i class="fas fa-chart-line"></i> Contract Groei: 15% toename</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">Recente Activiteit</h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-search"></i> Gezocht naar "vertrouwelijkheid"</li>
                                    <li><i class="fas fa-file-alt"></i> Nieuw contract toegevoegd: "Dienstverleningsovereenkomst 2023"</li>
                                    <li><i class="fas fa-edit"></i> Clausule bewerkt in "NDA Sjabloon"</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="input-group mb-3">
                            <input type="text" id="searchInput" class="form-control" placeholder="Zoek naar een clausule...">
                            <button class="btn btn-primary" type="button" id="searchButton">Zoeken</button>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div id="searchResults"></div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <button id="combineButton" class="btn btn-success" style="display: none;">Combineer Geselecteerde Clausules</button>
                        <div id="combinedClause" class="mt-3"></div>
                    </div>
                </div>
                <div class="row mt-4" id="feedbackSection" style="display: none;">
                    <div class="col-md-12">
                        <div class="inputgroup mb-3">
                            <input type="text" id="feedbackInput" class="form-control" placeholder="Geef feedback op de gecombineerde clausule...">
                            <button class="btn btn-primary" type="button" id="feedbackButton">Feedback Indienen</button>
                        </div>
                        <div id="generatedClause" class="mt-3"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="descriptionPanel">
        <h5>DataTalk Juridische Demo</h5>
        <p id="stepDescription"></p>
        <p><strong>Druk op de rechter pijltoets om naar de volgende stap te gaan.</strong></p>
    </div>

    <button id="startDemoButton">Start Demo</button>
    
    <div id="narrationOverlay">
        <span id="closeNarration">&times;</span>
        <p id="narrationText"></p>
    </div>

    <div id="demoControls">
        <button id="toggleAudio"><i class="fas fa-volume-up"></i></button>
        <button id="toggleSubtitles"><i class="fas fa-closed-captioning"></i></button>
    </div>

    <script>
        $(document).ready(function() {
            const sampleClauses = [
                {
                    text: "De Werknemer stemt ermee in de vertrouwelijkheid te bewaren van alle eigendomsrechtelijke en niet-openbare informatie verkregen tijdens zijn dienstverband bij het Bedrijf.",
                    filename: "Arbeidsovereenkomst_2023.docx",
                    author: "Jan Jansen",
                    lastModified: "2023-05-15",
                    keywords: ["vertrouwelijkheid", "eigendomsrechtelijk", "dienstverband", "geheimhouding", "niet-openbaarmaking", "privé", "geclassificeerd", "vertrouwelijk"]
                },
                {
                    text: "De verplichting van de Werknemer tot geheimhouding blijft van kracht na beëindiging van het dienstverband, ongeacht de reden van beëindiging.",
                    filename: "Beëindigingsovereenkomst.docx",
                    author: "Piet Pietersen",
                    lastModified: "2023-03-10",
                    keywords: ["vertrouwelijkheid", "beëindiging", "verplichting", "geheimhouding", "niet-openbaarmaking", "privé", "geclassificeerd", "vertrouwelijk"]
                },
                {
                    text: "Vertrouwelijke Informatie omvat, maar is niet beperkt tot, klantenlijsten, bedrijfsstrategieën, financiële gegevens, handelsgeheimen en alle andere informatie die door het Bedrijf als vertrouwelijk is aangemerkt.",
                    filename: "NDA_Sjabloon.pdf",
                    author: "Anna de Vries",
                    lastModified: "2023-04-22",
                    keywords: ["vertrouwelijk", "handelsgeheimen", "bedrijfsstrategieën", "geheimhouding", "eigendomsrechtelijke informatie", "geclassificeerd", "gevoelig","vertrouwelijk"]
                },
                {
                    text: "De Opdrachtnemer zal de diensten zoals beschreven in Bijlage A naar beste vermogen en in overeenstemming met de industriestandaarden uitvoeren.",
                    filename: "Dienstverleningsovereenkomst_2023.pdf",
                    author: "Sophie Bakker",
                    lastModified: "2023-06-01",
                    keywords: ["diensten", "opdrachtnemer", "standaarden", "verplichtingen", "prestatie", "taken", "verantwoordelijkheden"]
                },
                {
                    text: "Betaling voor geleverde diensten dient te geschieden binnen 30 dagen na ontvangst van de factuur.",
                    filename: "Consultancyovereenkomst.docx",
                    author: "Thomas Visser",
                    lastModified: "2023-05-28",
                    keywords: ["betaling", "factuur", "diensten", "vergoeding", "facturering", "beloning", "honorarium"]
                },
                {
                    text:"De Consultant zal worden vergoed tegen een tarief van €150 per uur voor geleverde diensten, met een maximum van 40 factureerbare uren per week, tenzij schriftelijk anders overeengekomen.",
                    filename: "Consultancyovereenkomst_2023.pdf",
                    author: "Emma Jansen",
                    lastModified: "2023-06-15",
                    keywords: ["vergoeding", "tarief", "beloning", "betaling", "factureerbaar", "uren", "consultant"]
                }
            ];
    
            let combinedClauseText = "";
    
            $('#searchButton').click(function() {
                const searchTerm = $('#searchInput').val().toLowerCase();
                const results = sampleClauses.filter(clause => 
                    clause.text.toLowerCase().includes(searchTerm) || 
                    clause.keywords.some(keyword => keyword.includes(searchTerm))
                );
                displayResults(results);
                $('#combinedClause').empty();
                $('#feedbackSection').hide();
                $('#generatedClause').empty();
            });
    
            function displayResults(results) {
                const $results = $('#searchResults');
                $results.empty();
                if (results.length === 0) {
                    $results.append('<p>Geen resultaten gevonden.</p>');
                } else {
                    const $row = $('<div class="row"></div>');
                    results.forEach((clause, index) => {
                        $row.append(`
                            <div class="col-md-4 mb-3">
                                <div class="card h-100 result-item fade-in" data-index="${index}">
                                    <div class="card-body">
                                        <h5 class="card-title">${clause.filename}</h5>
                                        <h6 class="card-subtitle mb-2 text-muted">Auteur: ${clause.author} | Laatst gewijzigd: ${clause.lastModified}</h6>
                                        <p class="card-text">${highlightSearchTerm(clause.text)}</p>
                                        <button class="btn btn-sm btn-outline-primary view-doc-btn">Bekijk Document</button>
                                    </div>
                                </div>
                            </div>
                        `);
                    });
                    $results.append($row);
                }
                $('#combineButton').show();
            }
    
            function highlightSearchTerm(text) {
                const searchTerm = $('#searchInput').val();
                if (!searchTerm) return text;
                const regex = new RegExp(searchTerm, 'gi');
                return text.replace(regex, match => `<mark>${match}</mark>`);
            }
    
            $(document).on('click', '.result-item', function() {
                $(this).toggleClass('selected');
            });
    
            $(document).on('click', '.view-doc-btn', function(e) {
                e.stopPropagation();
            });
    
            $('#combineButton').click(function() {
                const selectedClauses = $('.result-item.selected').map(function() {
                    return sampleClauses[$(this).data('index')].text;
                }).get();
    
                if (selectedClauses.length > 0) {
                    combinedClauseText = selectedClauses.join(' ');
                    $('#combinedClause').html(`<div class="alert alert-success fade-in">${combinedClauseText}</div>`);
                    $('#feedbackSection').show();
                } else {
                    $('#combinedClause').html('<div class="alert alert-warning fade-in">Geen clausules geselecteerd.</div>');
                    $('#feedbackSection').hide();
                }
            });
    
            $('#feedbackButton').click(function() {
                const feedback = $('#feedbackInput').val();
                if (feedback) {
                    const generatedClause = generateClause(combinedClauseText, feedback);
                    const diffHtml = highlightDifferences(combinedClauseText, generatedClause);
                    $('#generatedClause').html(`<div class="alert alert-info fade-in"><strong>Gegenereerde Clausule:</strong><br>${diffHtml}</div>`);
                    $('#generatedClause')[0].scrollIntoView({behavior: "smooth"});
                }
            });
    
            function generateClause(originalClause, feedback) {
                let generatedClause = originalClause;
    
                if (feedback.toLowerCase().includes("duur")) {
                    generatedClause = generatedClause.replace(
                        "De verplichting van de Werknemer tot geheimhouding blijft van kracht",
                        "De verplichting van de Werknemer tot geheimhouding blijft van kracht voor een periode van vijf (5) jaar"
                    );
                }
    
                if (feedback.toLowerCase().includes("voorbeelden")) {
                    generatedClause = generatedClause.replace(
                        "alle eigendomsrechtelijke en niet-openbare informatie",
                        "alle eigendomsrechtelijke en niet-openbare informatie, waaronder maar niet beperkt tot handelsgeheimen, klantenlijsten en financiële gegevens,"
                    );
                }
    
                return generatedClause;
            }
    
            function highlightDifferences(oldText, newText) {
                const dmp = new diff_match_patch();
                const diffs = dmp.diff_main(oldText, newText);
                dmp.diff_cleanupSemantic(diffs);
    
                let html = '';
                for (let i = 0; i < diffs.length; i++) {
                    const [type, text] = diffs[i];
                    if (type === 0) {
                        html += text;
                    } else if (type === 1) {
                        html += `<span class="diff-highlight">${text}</span>`;
                    }
                }
                return html;
            }
    
            function showMockDocument() {
                const mockDocument = $(`
                    <div id="mockDocument" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60%; height: 80%; background: white; border: none; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); z-index: 10000; padding: 30px; overflow-y: auto;">
                        <h2>Dienstverleningsovereenkomst 2023</h2>
                        <p>Deze Dienstverleningsovereenkomst (de "Overeenkomst") wordt aangegaan op [DATUM] tussen [NAAM KLANT] ("Klant") en [NAAM DIENSTVERLENER] ("Dienstverlener").</p>
                        <h3>1. Diensten</h3>
                        <p>De Opdrachtnemer zal de diensten zoals beschreven in Bijlage A naar beste vermogen en in overeenstemming met de industriestandaarden uitvoeren.</p>
                        <h3>2. Betaling</h3>
                        <p>Betaling voor geleverde diensten dient te geschieden binnen 30 dagen na ontvangst van de factuur.</p>
                        <h3>3. Vertrouwelijkheid</h3>
                        <p>De Opdrachtnemer stemt ermee in de vertrouwelijkheid te bewaren van alle eigendomsrechtelijke en niet-openbare informatie verkregen tijdens het uitvoeren van diensten voor de Klant.</p>
                        <button id="closeMockDocument" class="btn btn-primary" style="position: absolute; top: 20px; right: 20px;">Sluiten</button>
                    </div>
                `);
                $('body').append(mockDocument);
                $('#closeMockDocument').click(function() {
                    mockDocument.remove();
                });
            }
    
            const demoSteps = [
                {
                    action: () => moveCursor(400, 200),
                    description: "De cursor wordt naar het zoekinvoerveld verplaatst."
                },
                {
                    action: () => clickElement('#searchInput'),
                    description: "Klikken op het zoekinvoerveld om te beginnen met typen."
                },
                {
                    action: () => typeText('#searchInput', 'vertrouwelijk'),
                    description: "Typen van 'vertrouwelijk' in het zoekinvoerveld om relevante clausules te vinden."
                },
                {
                    action: () => clickElement('#searchButton'),
                    description: "Klikken op de zoekknop om de zoekopdracht uit te voeren."
                },
                {
                    action: () => new Promise(resolve => setTimeout(resolve, 2000)),
                    description: "De zoekresultaten voor clausules met 'vertrouwelijk' of gerelateerde trefwoorden worden bekeken."
                },
                {
                    action: () => clickElement('.result-item:eq(0)'),
                    description: "De eerste relevante clausule uit de zoekresultaten wordt geselecteerd."
                },
                {
                    action: () => clickElement('.result-item:eq(1)'),
                    description: "De tweede relevante clausule uit de zoekresultaten wordt geselecteerd."
                },
                {
                    action: () => clickElement('#combineButton'),
                    description: "De geselecteerde clausules worden gecombineerd om een uniforme vertrouwelijkheidsclausule te creëren."
                },
                {
                    action: () => new Promise(resolve => setTimeout(resolve, 2000)),
                    description: "De gecombineerde clausule wordt beoordeeld."
                },
                {
                    action: () => clickElement('#feedbackInput'),
                    description: "Er wordt voorbereid om feedback te geven op de gecombineerde clausule."
                },
                {
                    action: () => typeText('#feedbackInput', 'Voeg een specifieke duur toe voor de vertrouwelijkheidsverplichting'),
                    description: "Er wordt een wijziging van de clausule gevraagd om een specifieke duur voor de vertrouwelijkheidsverplichting op te nemen."
                },
                {
                    action: () => clickElement('#feedbackButton'),
                    description: "De feedback wordt ingediend om een verbeterde clausule te genereren."
                },
                {
                    action: () => new Promise(resolve => setTimeout(resolve, 2000)),
                    description: "De door AI gegenereerde clausule met de gevraagde wijzigingen wordt beoordeeld."
                },
                {
                    action: () => {
                        $('#searchInput').val('');
                        return Promise.resolve();
                    },
                    description: "Het zoekinvoerveld wordt gewist voor een nieuwe zoekopdracht."
                },
                {
                    action: () => clickElement('#searchInput'),
                    description: "Er wordt op het zoekinvoerveld geklikt om een nieuwe zoekopdracht te beginnen."
                },
                {
                    action: () => typeText('#searchInput', 'beloning'),
                    description: "Er wordt 'beloning' getypt om te zoeken naar betalingsgerelateerde clausules."
                },
                {
                    action: () => clickElement('#searchButton'),
                    description: "De zoekopdracht naar betalingsgerelateerde clausules wordt uitgevoerd."
                },
                {
                    action: () => new Promise(resolve => setTimeout(resolve, 2000)),
                    description: "De zoekresultaten voor betalingsgerelateerde clausules worden bekeken."
                },
                {
                    action: () => clickElement('.view-doc-btn:first'),
                    description: "Het volledige document met de geselecteerde betalingsclausule wordt bekeken."
                },
                {
                    action: () => {
                        showMockDocument();
                        return new Promise(resolve => setTimeout(resolve, 5000));
                    },
                    description: "Het volledige document wordt onderzocht om de context van de betalingsclausule te begrijpen."
                },
                {
                    action: () => {
                        $('#mockDocument').remove();
                        return Promise.resolve();
                    },
                    description: "De documentweergave wordt gesloten. Hiermee wordt de demonstratie van de AI Contract Clausule Zoektool afgesloten."
                }
            ];
    
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
    
            const debouncedNextStep = debounce(nextStep, 300);
    
            $(document).keydown(function(e) {
                if (e.which === 39) { // Rechter pijltoets
                    debouncedNextStep();
                }
            });
    
            function moveCursor(x, y, duration = 1000) {
                return new Promise(resolve => {
                    $('#cursor').animate({ left: x, top: y }, duration, resolve);
                });
            }
    
            function typeText(selector, text, delay = 50) {
                const element = $(selector);
                return new Promise(resolve => {
                    let i = 0;
                    const interval = setInterval(() => {
                        if (i < text.length) {
                            element.val(element.val() + text[i]);
                            i++;
                        } else {
                            clearInterval(interval);
                            resolve();
                        }
                    }, delay);
                });
            }
    
            function clickElement(selector) {
                return new Promise(resolve => {
                    const element = $(selector);
                    const offset = element.offset();
                    moveCursor(offset.left + element.width() / 2, offset.top + element.height() / 2)
                        .then(() => {
                            element.addClass('active');
                            setTimeout(() => {
                                element.removeClass('active');
                                element.click();
                                resolve();
                            }, 500);
                        });
                });
            }

            const narrationLines = [
            "Welkom bij DataTalk voor Juridische Professionals, een geavanceerd kennisbeheersysteem speciaal ontworpen voor juristen. Laten we eens kijken hoe het uw contractopstelling kan vereenvoudigen.",
            "We beginnen met het zoeken naar clausules over vertrouwelijkheid. Let op hoe de zoekbalk prominent aanwezig is voor gemakkelijke toegang.",
            "We typen 'vertrouwelijk' in het zoekveld. DataTalk gebruikt AI-gestuurde semantische zoektechnologie om relevante clausules te vinden, zelfs als ze dit exacte woord niet bevatten.",
            "De zoekopdracht wordt gestart. De AI-motor van DataTalk doorzoekt nu uw volledige documentenverzameling op relevante clausules.",
            "Hier zijn de zoekresultaten. Merk op hoe DataTalk clausules heeft gevonden die semantisch gerelateerd zijn aan 'vertrouwelijk', wat zijn begrip van de juridische context aantoont.",
            "We selecteren de eerste relevante clausule. Met DataTalk kunt u meerdere clausules kiezen om te combineren of te vergelijken.",
            "Nu selecteren we een tweede relevante clausule. Deze functie is vooral handig bij het opstellen van uitgebreide geheimhoudingsovereenkomsten.",
            "Door op 'Geselecteerde clausules combineren' te klikken, voegt DataTalk deze clausules intelligent samen, met behoud van samenhang en juridische nauwkeurigheid.",
            "Laten we de gecombineerde clausule bekijken. Merk op hoe DataTalk de belangrijkste elementen uit beide geselecteerde clausules naadloos heeft geïntegreerd.",
            "Nu kunnen we feedback geven of wijzigingen aanvragen voor de gecombineerde clausule. Dit toont aan hoe DataTalk clausules kan verfijnen op basis van specifieke eisen.",
            "We vragen om een specifieke duur voor de geheimhoudingsplicht. Dit laat de flexibiliteit van DataTalk zien bij het aanpassen van clausules.",
            "De feedback wordt ingediend. De AI van DataTalk zal dit verzoek nu verwerken en de clausule dienovereenkomstig aanpassen.",
            "Hier is de door AI gegenereerde clausule met de gevraagde aanpassingen. Merk op hoe deze de duur intelligent heeft verwerkt met behoud van de oorspronkelijke bedoeling.",
            "Laten we een nieuwe zoekopdracht starten om de veelzijdigheid van DataTalk te demonstreren. We wissen de vorige zoektermen.",
            "Nu bereiden we ons voor om te zoeken naar betalingsgerelateerde clausules. Dit illustreert hoe DataTalk kan helpen bij verschillende aspecten van het opstellen van contracten.",
            "We zoeken op 'vergoeding'. Opnieuw zal DataTalk zijn semantisch begrip gebruiken om relevante betalingsclausules te vinden.",
            "We starten de zoekopdracht naar betalingsgerelateerde clausules. DataTalk doorzoekt nu uw documentenverzameling.",
            "Hier zijn de resultaten voor betalingsgerelateerde clausules. Merk de verscheidenheid aan relevante clausules op die DataTalk heeft gevonden.",
            "Met DataTalk kunt u ook het volledige document bekijken dat een specifieke clausule bevat. Deze functie helpt u de bredere context van elke clausule te begrijpen.",
            "We bekijken nu het volledige document. Deze functie is cruciaal om ervoor te zorgen dat geselecteerde clausules aansluiten bij de algehele contractstructuur en -intentie.",
            "Hiermee sluiten we onze demonstratie van DataTalk voor Juridische Professionals af. Zoals u heeft gezien, vereenvoudigt het aanzienlijk het proces van contractopstelling, waardoor u efficiënt en intelligent gebruik kunt maken van uw bestaande documentenverzameling."
        ];

            let currentStep = 0;
            let isStepInProgress = false;
            let audioContext;
            let currentAudio;
            
            function initAudio() {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            let isMuted = false;
            let showSubtitles = true;
            
            function showNarration(text) {
                if (showSubtitles) {
                    $('#narrationText').text(text);
                    $('#narrationOverlay').fadeIn(300);
                }
            }
            
            function playAudio(index) {
                return new Promise((resolve) => {
                    if (currentAudio) {
                        currentAudio.pause();
                    }
                    currentAudio = new Audio(`${index}.mp3`);
                    const source = audioContext.createMediaElementSource(currentAudio);
                    source.connect(audioContext.destination);
                    currentAudio.onended = resolve;
                    if (!isMuted) {
                        currentAudio.play();
                    } else {
                        setTimeout(resolve, 2000); // Simuleer audioduur indien gedempt
                    }
                });
            }
            
            $('#closeNarration').click(function() {
                $('#toggleSubtitles').click(); // Simuleer een klik op de 'CC' knop
            });
            
            $('#toggleAudio').click(function() {
                isMuted = !isMuted;
                $(this).html(isMuted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>');
                if (currentAudio) {
                    if (isMuted) {
                        currentAudio.pause();
                    } else {
                        currentAudio.play();
                    }
                }
            });
            
            $('#toggleSubtitles').click(function() {
                showSubtitles = !showSubtitles;
                $(this).html(showSubtitles ? '<i class="fas fa-closed-captioning"></i>' : '<i class="fas fa-closed-captioning" style="text-decoration: line-through;"></i>');
                if (showSubtitles) {
                    showNarration(narrationLines[currentStep - 1]);
                } else {
                    $('#narrationOverlay').fadeOut(300);
                }
            });
            
            async function nextStep() {
                if (currentStep < demoSteps.length && !isStepInProgress) {
                    isStepInProgress = true;
                    const step = demoSteps[currentStep];
                    
                    showNarration(narrationLines[currentStep]);
                    await playAudio(currentStep);
                    await step.action();
                    
                    if (!showSubtitles) {
                        $('#narrationOverlay').fadeOut(300);
                    }
                    
                    currentStep++;
                    isStepInProgress = false;
                    
                    // Scroll terug naar boven na het indienen van feedback
                    if (currentStep === 14) {
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    }
                    
                    // Ga automatisch naar de volgende stap
                    if (currentStep < demoSteps.length) {
                        setTimeout(nextStep, 1000); // Wacht 1 seconde voordat de volgende stap start
                    }
                }
            }

        function initializeDemo() {
            const cursor = $('<div id="cursor" style="position: fixed; width: 20px; height: 20px; background: rgba(255, 0, 0, 0.5); border-radius: 50%; pointer-events: none; z-index: 9999;"></div>');
            $('body').append(cursor);
            initAudio();
        }

        $('#startDemoButton').click(function() {
            $(this).fadeOut(300, function() {
                $(this).remove();
                initializeDemo();
                nextStep(); // Start de demo
            });
        });

        // Voeg de keydown event listener opnieuw toe voor handmatige voortgang
        $(document).keydown(function(e) {
            if (e.which === 39) { // Rechter pijltoets
                nextStep();
            }
        });
    });
</script>
</body>
</html>